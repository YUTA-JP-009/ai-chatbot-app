# 社内ルール対応AIチャットボット開発プロジェクト

## 1. プロジェクト概要

### 目的
OneDriveやGoogle Driveに保管されている社内規程のドキュメント（PDF, Excel等）を学習し、社員がChatworkから質問すると自動で回答するAIチャットボットを開発する。

### 技術スタック
- **AI基盤**: Google Cloud Platform (GCP)
  - **AIサービス**: Vertex AI Search & Conversation
  - **AIモデル**: Gemini (Flashシリーズなど高速なモデルを想定)
  - **データ連携**: Cloud Functions
- **アプリケーション**: Next.js (App Router)
- **ホスティング**: Vercel
- **連携サービス**:
  - Chatwork API (Webhook)
  - Microsoft Graph API (OneDrive)
  - Google Drive API

### その他要件
- **応答性能**: 原則3秒以内の高速応答を目指す。ストリーミング応答やキャッシュも視野に入れる。
Githubへのコミット名は日本語で記載する。

---

## 2. これまでの進捗サマリー

### Step 1: GCPのセットアップ
- GCPプロジェクトを新規作成済み。
- 以下のAPIを有効化済み。
  - `Vertex AI API`
  - `Cloud Functions API`
  - `Cloud Storage API`
- Vercelからの認証用として**サービスアカウントを作成済み**。
- 認証情報が記載された**JSONキーファイルをダウンロード済み**。

### Step 2: 開発環境のセットアップ
- `npx create-next-app`コマンドで、ローカルPCに`ai-chatbot-app`という名称のNext.jsプロジェクトを作成済み。
- 以下の構成でセットアップ済み。
  - Linter: ESLint
  - Tailwind CSS: Yes
  - `src/` directory: Yes
  - App Router: Yes

### Step 3: VercelとGitHubのセットアップ
- GitHubにリポジトリを作成し、ローカルのNext.jsプロジェクトをプッシュ済み。
- Vercelにプロジェクトを作成し、GitHubリポジトリと連携済み。
- Vercelの環境変数に以下を設定済み。
  - `BOT_PREFIX`: `お調べしています...` (Added 4h ago)
  - `BOT_PERSONALITY`: `friendly` (Added 4h ago)
  - `GCP_DATA_STORE_ID`: `internal-rules-cloudstorage_175...` (Updated 19h ago)
  - `GCP_CREDENTIALS`: ダウンロードしたJSONキーファイルの中身を全て設定 (Added Sep 23)
  - `CHATWORK_WEBHOOK_TOKEN`: `kBPhP7ID9abRMautz//FHPSEN2z0B4NN...` (Updated Sep 23)
  - `CHATWORK_API_TOKEN`: `d5d750c100c3351b9a6508aa9c65d7c2` (Added Sep 15)
  - `CHATWORK_MY_ID`: `jp-aichat` (Added Sep 15)
  - `GCP_PROJECT_ID`: `ai-chatbot-prod-472104` (Added Sep 15)

### Step 4: APIエンドポイントの作成
- ChatworkからのWebhookを受け取るためのAPIルートとして、以下のファイルを正しい階層に作成済み。
  - **ファイルパス**: `app/api/chatwork/route.ts`
- 上記ファイルに、Webhookリクエストの受け取りと、GCPのAIを呼び出す関数の雛形コードを貼り付け済み。

### Step 5: Discovery Engine（Data Store）の設定
- **Data Store名**: `internal-rules-search`
- **Collection ID**: `175794210581`
- **リージョン**: `global`
- **接続済みのアプリ**: `internal-rules-search`
- **データソース**: Google Drive連携済み（ドライブID: `1vAFoU52a84plm8thsOUyVf54JjIh57wX`）
- **コネクタの状態**: 有効（接続済み）
- **自動同期**: 有効

---

### データソース（GCPに格納した社内ルール）

# 株式会社AAA 社内ルール

## 1. 勤務・勤怠に関するルール

### 勤務形態
- **制度**: コアタイム付きフレックスタイム制
- **コアタイム**: **11:00～16:00** （この時間帯は原則として業務に従事）
- **フレキシブルタイム**: **7:00～11:00** および **16:00～21:00**

### リモートワーク
- **選択**: **週3日まで**可能
- **運用**: 所属チームの状況に応じて柔軟に運用
- **OJT期間**: 入社後**3ヶ月間**は、原則として**週4日以上**出社

### パワーナップ制度
- **内容**: **13:00～15:00**の間で、**20分以内**の仮眠（昼寝）を推奨
- **場所**: 仮眠室または自席での仮眠が可能

### ノー残業デー
- **実施日**: 毎週水曜日は全社一斉ノー残業デー
- **ルール**: **19:00**には完全退社を徹底

## 2. 会議・コミュニケーションに関するルール

### 会議の時間
- **原則**: 社内会議は**30分以内**
- **必須事項**: 会議の招待には、必ず**アジェンダ（議題）**と**ゴール（会議の着地点）**を記載

### チャットツール利用ガイドライン
- **メンション**: 緊急時を除き、`@all` や `@channel` の使用は避ける
- **分報(Times)チャンネル**: 各自が任意で作成し、業務ログや気づきの発信の場として活用を推奨
- **スタンプ・絵文字**: ポジティブなコミュニケーション促進のため、積極的な活用を推奨

### シャッフルランチ
- **実施日**: 毎月**第2木曜日**
- **内容**: 部署や役職を越えてランダムに組まれた**4人組**でランチ
- **費用補助**: 1人**1,500円**まで会社が補助

## 3. 福利厚生・手当に関するルール

### 書籍購入・セミナー参加費補助
- **目的**: 自己成長を目的とした書籍購入や外部セミナーへの参加
- **補助額**: **月額10,000円**まで

### リモートワーク手当
- **目的**: リモートワークの環境整備
- **支給額**: **月額5,000円**

### アニバーサリー休暇
- **内容**: 自身が定めた記念日（誕生日、結婚記念日など）に**年間1日**の特別休暇を取得可能

### ピアボーナス制度
- **内容**: 従業員同士が日々の感謝や称賛をポイントとして送り合える制度
- **インセンティブ**: 貯まったポイントは、月末に換金可能

## 4. オフィス環境に関するルール

### 座席
- **制度**: 部署ごとに大まかなエリアが決められた**フリーアドレス制**
- **集中ブース**: 予約制の「サイレントブース」を利用可能

### 服装
- **原則**: 完全服装自由（ただし、社外の方と会う際はTPOを考慮）
- **カジュアルフライデー**: 毎週金曜日は、好きなバンドTシャツやキャラクターTシャツの着用も可能

### フリードリンク・フリースナック
- **無料提供**: コーヒー、お茶、ミネラルウォーターは常時無料
- **補充**: 毎週月曜日の朝に、健康志向のシリアル、ナッツ、フルーツが補充される

## 5. その他ユニークなルール

### 部活動支援制度
- **設立条件**: 従業員が**5名以上**集まれば申請可能
- **活動費補助**: 認定された部には、**月額上限20,000円**を補助 (例：フットサル部、ボードゲーム部、サウナ部など)

### 副業
- **条件**: **事前申請・承認制**で許可
- **推奨事項**: 本業に支障が出ない範囲で、自身のスキルアップに繋がる活動

### サンクスカード
- **内容**: 毎月末、日頃の感謝を伝えたい相手に手書きのメッセージカードを渡す文化
- **設備**: オフィス内に専用ポストを設置




### Vertex AI Search用 JSONL生成ルール
1. 基本ルール：1行 = 1ドキュメント
ファイルは.jsonl形式で作成し、1行に1つの完全なJSONオブジェクトを記述します。行の末尾にカンマ , は付けません。

2. トップレベルのフィールド名
各JSONオブジェクト（各行）のトップレベルで使用できるキーは、Vertex AI Searchが予約したフィールド名のみです。主要なものは以下の通りです。

フィールド名	必須	データ型	説明
id	はい	文字列	ドキュメントを一意に識別するためのID。
content	はい	オブジェクト	検索対象となる本文。{"text": "..."}形式にする必要があります。
structData	いいえ	JSONオブジェクト	構造化データ（タイトル、カテゴリ、キーワードなど）を格納する場所。

Google スプレッドシートにエクスポート
3. contentフィールドのルール
contentの値は、必ず{"text": "..."}という形式のオブジェクトでなければなりません。

正しい例: "content": {"text": "こちらが本文です。"}

間違いの例: "content": "こちらが本文です。"

4. カスタムフィールドのルール
titleやcategory、keywordsといった独自のフィールドは、トップレベルに置けません。必ずstructDataオブジェクトの中に入れてください。

正しい例: "structData": {"title": "ルール名", "category": "カテゴリ名"}

間違いの例: "title": "ルール名" （トップレベルに置かれている）

テンプレート（この形式に合わせる）
JSON

{"id": "ユニークなID", "structData": {"title": "この文書のタイトル", "category": "カテゴリ情報"}, "content": {"text": "AIに読ませたい本文の内容をここに記述します。"}}
このルールに従うことで、これまでのINCORRECT_JSON_FORMATエラーを回避し、正常にドキュメントをインポートできます。